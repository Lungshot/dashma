<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashma Admin</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=Fira+Code:wght@300;400;500&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@300;400;500&family=Lato:wght@300;400;700&family=Lora:wght@400;500;600&family=Merriweather:wght@300;400;700&family=Montserrat:wght@300;400;500;600&family=Nunito:wght@300;400;500;600&family=Open+Sans:wght@300;400;500;600&family=Playfair+Display:wght@400;500;600&family=Poppins:wght@300;400;500;600&family=Roboto+Mono:wght@300;400;500&family=Roboto:wght@300;400;500;700&family=Source+Sans+Pro:wght@300;400;600&family=Work+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
  <div class="admin-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1 class="sidebar-title">Dashma</h1>
      </div>
      <nav class="sidebar-nav">
        <a class="nav-item active" data-panel="appearance">Appearance</a>
        <a class="nav-item" data-panel="categories">Categories</a>
        <a class="nav-item" data-panel="links">Links</a>
        <a class="nav-item" data-panel="widgets">Widgets</a>
        <a class="nav-item" data-panel="requests">Requests <span class="badge" id="requestsBadge"></span></a>
        <a class="nav-item" data-panel="auth">Authentication</a>
        <a class="nav-item" data-panel="backup">Backup</a>
        <a class="nav-item" data-panel="account">Account</a>
      </nav>
      <div class="sidebar-footer">
        <a href="/" target="_blank">View Site</a> &nbsp;|&nbsp;
        <a href="/admin/logout">Logout</a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      
      <!-- Appearance Panel -->
      <div class="panel active" id="panel-appearance">
        <div class="content-header">
          <h2 class="content-title">Appearance</h2>
          <p class="content-subtitle">Customize the look and feel of your dashboard</p>
        </div>

        <div class="card">
          <h3 class="card-title">Site Title</h3>
          <div class="form-group">
            <label class="form-label">Site Name</label>
            <input type="text" class="form-input" id="siteName" placeholder="Dashma">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Title Size</label>
              <select class="form-select" id="titleSize">
                <option value="small">Small</option>
                <option value="medium">Medium</option>
                <option value="large">Large</option>
                <option value="xlarge">Extra Large</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Title Alignment</label>
              <select class="form-select" id="titleAlignment">
                <option value="left">Left</option>
                <option value="center">Center</option>
                <option value="right">Right</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Title Hover Effect</label>
              <select class="form-select" id="titleHoverEffect">
                <option value="none">None</option>
                <option value="glow">Glow</option>
                <option value="fade">Fade</option>
                <option value="scale">Scale</option>
                <option value="underline">Underline</option>
                <option value="hacked">Hacked (Matrix)</option>
                <option value="glitch">Glitch</option>
                <option value="neon">Neon Pulse</option>
                <option value="blur">Blur In</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Title Link URL (optional)</label>
              <input type="text" class="form-input" id="titleLinkUrl" placeholder="https://example.com">
            </div>
          </div>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="showTitle">
              <span>Show Site Title</span>
            </label>
          </div>
        </div>

        <div class="card">
          <h3 class="card-title">Site Logo</h3>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="showLogo">
              <span>Show Site Logo</span>
            </label>
          </div>
          <div id="logoOptionsContainer">
            <div class="form-group">
              <label class="form-label">Logo Display</label>
              <select class="form-select" id="siteLogoMode">
                <option value="none">No Logo</option>
                <option value="favicon">Use Site Favicon</option>
                <option value="custom">Custom Logo</option>
              </select>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Logo Size</label>
                <select class="form-select" id="logoSize">
                  <option value="small">Small</option>
                  <option value="medium">Medium</option>
                  <option value="large">Large</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Logo Position</label>
                <select class="form-select" id="logoPosition">
                  <option value="above">Above Title</option>
                  <option value="below">Below Title</option>
                  <option value="inline">Inline with Title</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Logo Alignment</label>
                <select class="form-select" id="logoAlignment">
                  <option value="left">Left</option>
                  <option value="center">Center</option>
                  <option value="right">Right</option>
                </select>
              </div>
            </div>
            <div class="form-group" id="customLogoUpload">
              <div class="file-upload" id="logoImageUpload">
                <input type="file" accept="image/*" id="logoImageInput">
                <p class="file-upload-text">Click or drag to upload logo image</p>
              </div>
              <div class="preview-container" id="logoImagePreview"></div>
              <button class="btn btn-sm btn-danger" id="clearLogoImage">Clear Logo</button>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 class="card-title">Colors</h3>
          <div class="form-group">
            <label class="form-label">Color Theme</label>
            <select class="form-select" id="colorTheme">
              <option value="custom">Custom (Manual Colors)</option>
              <optgroup label="Dark Themes" id="darkThemesGroup"></optgroup>
              <optgroup label="Light Themes" id="lightThemesGroup"></optgroup>
            </select>
            <p class="text-muted" style="margin-top: 0.5rem; font-size: 0.85rem;">Select a pre-made theme or choose "Custom" to set colors manually.</p>
          </div>
          <div id="customColorsContainer">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Background Color</label>
              <div class="color-picker-wrapper">
                <input type="color" class="color-picker" id="bgColorPicker" value="#212121">
                <input type="text" class="form-input color-value" id="backgroundColor" value="#212121">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Text Color</label>
              <div class="color-picker-wrapper">
                <input type="color" class="color-picker" id="textColorPicker" value="#ffffff">
                <input type="text" class="form-input color-value" id="textColor" value="#ffffff">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Accent Color</label>
              <div class="color-picker-wrapper">
                <input type="color" class="color-picker" id="accentColorPicker" value="#888888">
                <input type="text" class="form-input color-value" id="accentColor" value="#888888">
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Category Background</label>
              <div class="color-picker-wrapper">
                <input type="color" class="color-picker" id="categoryBgColorPicker" value="#ffffff">
                <input type="text" class="form-input color-value" id="categoryBgColor" value="rgba(255,255,255,0.03)">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Category Title Color</label>
              <div class="color-picker-wrapper">
                <input type="color" class="color-picker" id="categoryTitleColorPicker" value="#ffffff">
                <input type="text" class="form-input color-value" id="categoryTitleColor" value="#ffffff">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Link Card Background</label>
              <div class="color-picker-wrapper">
                <input type="color" class="color-picker" id="linkCardBgColorPicker" value="#ffffff">
                <input type="text" class="form-input color-value" id="linkCardBgColor" value="rgba(255,255,255,0.05)">
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Tag Background</label>
              <div class="color-picker-wrapper">
                <input type="color" class="color-picker" id="tagBgColorPicker" value="#ffffff">
                <input type="text" class="form-input color-value" id="tagBgColor" value="rgba(255,255,255,0.1)">
              </div>
            </div>
          </div>
          </div>
          <button class="btn btn-sm btn-secondary" id="resetColors">Reset Colors to Default</button>
        </div>

        <div class="card">
          <h3 class="card-title">Background Image</h3>
          <div class="form-group">
            <div class="file-upload" id="bgImageUpload">
              <input type="file" accept="image/*" id="bgImageInput">
              <p class="file-upload-text">Click or drag to upload background image</p>
            </div>
            <div class="preview-container" id="bgImagePreview"></div>
          </div>
          <button class="btn btn-sm btn-danger" id="clearBgImage">Clear Background Image</button>
        </div>

        <div class="card">
          <h3 class="card-title">Typography</h3>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Body Font</label>
              <select class="form-select" id="fontFamily">
                <optgroup label="Sans-Serif (Modern)">
                  <option value="'Inter', sans-serif">Inter</option>
                  <option value="'Poppins', sans-serif">Poppins</option>
                  <option value="'Roboto', sans-serif">Roboto</option>
                  <option value="'Open Sans', sans-serif">Open Sans</option>
                  <option value="'Nunito', sans-serif">Nunito</option>
                  <option value="'Lato', sans-serif">Lato</option>
                  <option value="'Montserrat', sans-serif">Montserrat</option>
                  <option value="'Source Sans Pro', sans-serif">Source Sans Pro</option>
                  <option value="'Work Sans', sans-serif">Work Sans</option>
                  <option value="'DM Sans', sans-serif">DM Sans</option>
                </optgroup>
                <optgroup label="Sans-Serif (System)">
                  <option value="'Arial', sans-serif">Arial</option>
                  <option value="'Helvetica Neue', sans-serif">Helvetica Neue</option>
                  <option value="system-ui, sans-serif">System UI</option>
                  <option value="'Segoe UI', sans-serif">Segoe UI</option>
                </optgroup>
                <optgroup label="Monospace">
                  <option value="'Courier New', Courier, monospace">Courier New</option>
                  <option value="'Consolas', monospace">Consolas</option>
                  <option value="'Monaco', monospace">Monaco</option>
                  <option value="'Roboto Mono', monospace">Roboto Mono</option>
                  <option value="'Fira Code', monospace">Fira Code</option>
                  <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
                </optgroup>
                <optgroup label="Serif">
                  <option value="'Georgia', serif">Georgia</option>
                  <option value="'Playfair Display', serif">Playfair Display</option>
                  <option value="'Merriweather', serif">Merriweather</option>
                  <option value="'Lora', serif">Lora</option>
                </optgroup>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Title Font</label>
              <select class="form-select" id="titleFontFamily">
                <optgroup label="Sans-Serif (Modern)">
                  <option value="'Inter', sans-serif">Inter</option>
                  <option value="'Poppins', sans-serif">Poppins</option>
                  <option value="'Roboto', sans-serif">Roboto</option>
                  <option value="'Open Sans', sans-serif">Open Sans</option>
                  <option value="'Nunito', sans-serif">Nunito</option>
                  <option value="'Lato', sans-serif">Lato</option>
                  <option value="'Montserrat', sans-serif">Montserrat</option>
                  <option value="'Source Sans Pro', sans-serif">Source Sans Pro</option>
                  <option value="'Work Sans', sans-serif">Work Sans</option>
                  <option value="'DM Sans', sans-serif">DM Sans</option>
                </optgroup>
                <optgroup label="Sans-Serif (System)">
                  <option value="'Arial', sans-serif">Arial</option>
                  <option value="'Helvetica Neue', sans-serif">Helvetica Neue</option>
                  <option value="system-ui, sans-serif">System UI</option>
                  <option value="'Segoe UI', sans-serif">Segoe UI</option>
                </optgroup>
                <optgroup label="Monospace">
                  <option value="'Courier New', Courier, monospace">Courier New</option>
                  <option value="'Consolas', monospace">Consolas</option>
                  <option value="'Monaco', monospace">Monaco</option>
                  <option value="'Roboto Mono', monospace">Roboto Mono</option>
                  <option value="'Fira Code', monospace">Fira Code</option>
                  <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
                </optgroup>
                <optgroup label="Serif">
                  <option value="'Georgia', serif">Georgia</option>
                  <option value="'Playfair Display', serif">Playfair Display</option>
                  <option value="'Merriweather', serif">Merriweather</option>
                  <option value="'Lora', serif">Lora</option>
                </optgroup>
              </select>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 class="card-title">Layout</h3>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Columns</label>
              <select class="form-select" id="columns">
                <option value="1">1 Column</option>
                <option value="2">2 Columns</option>
                <option value="3">3 Columns</option>
                <option value="4">4 Columns</option>
                <option value="5">5 Columns</option>
                <option value="6">6 Columns</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Link Display Mode</label>
              <select class="form-select" id="linkDisplayMode">
                <option value="cards">Cards</option>
                <option value="text">Text Only</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Link Open Behavior</label>
              <select class="form-select" id="linkOpenBehavior">
                <option value="newTab">New Tab</option>
                <option value="sameTab">Same Tab</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="showLinkIcons">
              <span>Show Link Icons (favicons)</span>
            </label>
          </div>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="showCategoryBackground">
              <span>Show Category Background (disable for compact view)</span>
            </label>
          </div>
        </div>

        <div class="card">
          <h3 class="card-title">Animations</h3>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Link Hover Effect</label>
              <select class="form-select" id="linkHoverEffect">
                <option value="glow">Glow</option>
                <option value="fade">Fade</option>
                <option value="scale">Scale</option>
                <option value="underline">Underline</option>
                <option value="slide">Slide</option>
                <option value="border">Border</option>
                <option value="hacked">Hacked (Matrix)</option>
                <option value="typewriter">Typewriter</option>
                <option value="glitch">Glitch</option>
                <option value="neon">Neon Pulse</option>
                <option value="blur">Blur In</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Category Hover Effect</label>
              <select class="form-select" id="categoryHoverEffect">
                <option value="fade">Fade</option>
                <option value="glow">Glow</option>
                <option value="scale">Scale</option>
                <option value="color">Color Change</option>
                <option value="underline">Underline</option>
                <option value="slide">Slide</option>
                <option value="hacked">Hacked (Matrix)</option>
                <option value="glitch">Glitch</option>
                <option value="neon">Neon Pulse</option>
                <option value="blur">Blur In</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Category Heading Size</label>
              <select class="form-select" id="categoryHeadingSize">
                <option value="small">Small</option>
                <option value="medium">Medium</option>
                <option value="large">Large</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Nesting Animation</label>
              <select class="form-select" id="nestingAnimation">
                <option value="slide">Slide</option>
                <option value="fade">Fade</option>
                <option value="zoom">Zoom</option>
                <option value="blur">Blur</option>
                <option value="flip">Flip</option>
                <option value="bounce">Bounce</option>
                <option value="rotate">Rotate</option>
                <option value="swing">Swing</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="showCategoryArrow">
              <span>Show Category Collapse Arrow</span>
            </label>
          </div>
        </div>

        <div class="card">
          <h3 class="card-title">Footer</h3>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="showFooter">
              <span>Show Footer</span>
            </label>
          </div>
          <div class="form-group">
            <label class="form-label">Footer Text</label>
            <input type="text" class="form-input" id="footerText" placeholder="Â© 2024 My Dashboard">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Footer Size</label>
              <select class="form-select" id="footerSize">
                <option value="small">Small</option>
                <option value="medium">Medium</option>
                <option value="large">Large</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Footer Alignment</label>
              <select class="form-select" id="footerAlignment">
                <option value="left">Left</option>
                <option value="center">Center</option>
                <option value="right">Right</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Footer Hover Effect</label>
              <select class="form-select" id="footerHoverEffect">
                <option value="none">None</option>
                <option value="glow">Glow</option>
                <option value="fade">Fade</option>
                <option value="scale">Scale</option>
                <option value="neon">Neon Pulse</option>
                <option value="blur">Blur In</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 class="card-title">Request Link</h3>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="showRequestLink">
              <span>Show Request Link (centered below footer)</span>
            </label>
          </div>
          <div class="form-group">
            <label class="form-label">Link Text</label>
            <input type="text" class="form-input" id="requestLinkText" placeholder="Request Link Addition">
          </div>
          <div class="form-group">
            <label class="form-label">Link URL</label>
            <input type="text" class="form-input" id="requestLinkUrl" placeholder="/request">
          </div>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary" id="saveAppearance">Save Changes</button>
        </div>
      </div>

      <!-- Categories Panel -->
      <div class="panel" id="panel-categories">
        <div class="content-header">
          <h2 class="content-title">Categories</h2>
          <p class="content-subtitle">Organize your links into categories</p>
        </div>

        <div class="card">
          <div class="btn-group mb-20">
            <button class="btn btn-primary" id="addCategoryBtn">Add Category</button>
          </div>
          <ul class="item-list" id="categoryList">
            <!-- Categories rendered here -->
          </ul>
        </div>
      </div>

      <!-- Links Panel -->
      <div class="panel" id="panel-links">
        <div class="content-header">
          <h2 class="content-title">Links</h2>
          <p class="content-subtitle">Manage your dashboard links</p>
        </div>

        <div class="card">
          <div class="form-row mb-20">
            <div class="form-group" style="margin-bottom: 0;">
              <select class="form-select" id="linkCategoryFilter">
                <option value="">All Categories</option>
              </select>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <button class="btn btn-primary" id="addLinkBtn">Add Link</button>
            </div>
          </div>
          <ul class="item-list" id="linkList">
            <!-- Links rendered here -->
          </ul>
        </div>
      </div>

      <!-- Widgets Panel -->
      <div class="panel" id="panel-widgets">
        <div class="content-header">
          <h2 class="content-title">Widgets</h2>
          <p class="content-subtitle">Add and manage dashboard widgets</p>
        </div>

        <div class="card">
          <div class="btn-group mb-20">
            <button class="btn btn-primary" id="addWidgetBtn">Add Widget</button>
          </div>
          <ul class="item-list" id="widgetList">
            <!-- Widgets rendered here -->
          </ul>
        </div>
      </div>

      <!-- Requests Panel -->
      <div class="panel" id="panel-requests">
        <div class="content-header">
          <h2 class="content-title">Requests</h2>
          <p class="content-subtitle">Review and approve user-submitted categories and links</p>
        </div>

        <div class="card">
          <h3 class="card-title">Category Requests</h3>
          <p class="text-muted mb-20">Users can submit requests at <a href="/request" target="_blank">/request</a></p>
          <div class="request-filter mb-20">
            <select class="form-select" id="categoryRequestFilter" style="width: auto; display: inline-block;">
              <option value="pending">Pending</option>
              <option value="approved">Approved</option>
              <option value="denied">Denied</option>
              <option value="all">All</option>
            </select>
          </div>
          <ul class="item-list" id="categoryRequestList">
            <li class="no-items">No category requests</li>
          </ul>
        </div>

        <div class="card">
          <h3 class="card-title">Link Requests</h3>
          <div class="request-filter mb-20">
            <select class="form-select" id="linkRequestFilter" style="width: auto; display: inline-block;">
              <option value="pending">Pending</option>
              <option value="approved">Approved</option>
              <option value="denied">Denied</option>
              <option value="all">All</option>
            </select>
          </div>
          <ul class="item-list" id="linkRequestList">
            <li class="no-items">No link requests</li>
          </ul>
        </div>
      </div>

      <!-- Authentication Panel -->
      <div class="panel" id="panel-auth">
        <div class="content-header">
          <h2 class="content-title">Authentication</h2>
          <p class="content-subtitle">Configure how users access your dashboard</p>
        </div>

        <div class="card">
          <h3 class="card-title">Admin Authentication</h3>
          <p class="text-muted mb-20">Controls access to this admin panel. Admin authentication is always required.</p>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Admin Auth Type</label>
              <select class="form-select" id="authMode">
                <option value="basic">Basic Authentication</option>
                <option value="entraId">Microsoft Entra ID (SSO)</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 class="card-title">Main Site Authentication</h3>
          <p class="text-muted mb-20">Controls access to the main dashboard page for regular users.</p>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Main Site Auth Type</label>
              <select class="form-select" id="mainAuthMode">
                <option value="none">No Authentication (Public)</option>
                <option value="basic">Basic Authentication</option>
                <option value="entraId">Microsoft Entra ID (SSO)</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card" id="entraIdSettings">
          <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem;">
            <h3 class="card-title" style="margin-bottom: 0;">Microsoft Entra ID Settings</h3>
            <button class="btn btn-sm btn-primary" id="launchEntraWizard">Setup Wizard</button>
          </div>
          <p class="text-muted mb-20" style="margin-top: 0.5rem;">Configure SSO for admin and/or main site access. Use the Setup Wizard for guided configuration.</p>
          <div class="form-group">
            <label class="form-label">Client ID</label>
            <input type="text" class="form-input" id="entraClientId" placeholder="Application (client) ID">
          </div>
          <div class="form-group">
            <label class="form-label">Tenant ID</label>
            <input type="text" class="form-input" id="entraTenantId" placeholder="Directory (tenant) ID">
          </div>
          <div class="form-group">
            <label class="form-label">Client Secret</label>
            <input type="password" class="form-input" id="entraClientSecret" placeholder="Client secret value">
          </div>
          <div class="form-group">
            <label class="form-label">Redirect URI</label>
            <input type="text" class="form-input" id="entraRedirectUri" placeholder="https://yourdomain.com/admin/callback">
          </div>
        </div>

        <div class="card" id="userManagementCard">
          <h3 class="card-title">User Management</h3>
          <p class="text-muted mb-20">Manage users who can access the main site when basic authentication is enabled.</p>
          <div class="btn-group mb-20">
            <button class="btn btn-primary" id="addUserBtn">Add User</button>
          </div>
          <ul class="item-list" id="userList">
            <!-- Users rendered here -->
          </ul>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary" id="saveAuth">Save Authentication Settings</button>
        </div>
      </div>

      <!-- Backup Panel -->
      <div class="panel" id="panel-backup">
        <div class="content-header">
          <h2 class="content-title">Backup & Restore</h2>
          <p class="content-subtitle">Export and import your configuration</p>
        </div>

        <div class="card">
          <h3 class="card-title">Export Configuration</h3>
          <p class="text-muted mb-20">Download your current configuration as a JSON file.</p>
          <button class="btn btn-primary" id="exportConfig">Download Config</button>
        </div>

        <div class="card">
          <h3 class="card-title">Import Configuration</h3>
          <p class="text-muted mb-20">Upload a previously exported configuration file.</p>
          <div class="file-upload" id="importConfigUpload">
            <input type="file" accept=".json" id="importConfigInput">
            <p class="file-upload-text">Click or drag to upload config file</p>
          </div>
        </div>
      </div>

      <!-- Account Panel -->
      <div class="panel" id="panel-account">
        <div class="content-header">
          <h2 class="content-title">Account Settings</h2>
          <p class="content-subtitle">Manage your admin credentials</p>
        </div>

        <div class="card">
          <h3 class="card-title">Change Credentials</h3>
          <div class="form-group">
            <label class="form-label">Username</label>
            <input type="text" class="form-input" id="adminUsername" placeholder="admin">
          </div>
          <div class="form-group">
            <label class="form-label">New Password</label>
            <input type="password" class="form-input" id="adminPassword" placeholder="Leave blank to keep current">
          </div>
          <div class="form-group">
            <label class="form-label">Confirm Password</label>
            <input type="password" class="form-input" id="adminPasswordConfirm" placeholder="Confirm new password">
          </div>
          <button class="btn btn-primary" id="saveCredentials">Update Credentials</button>
        </div>
      </div>

    </main>
  </div>

  <!-- Category Modal -->
  <div class="modal-overlay" id="categoryModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="categoryModalTitle">Add Category</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="categoryId">
        <div class="form-group">
          <label class="form-label">Category Name</label>
          <input type="text" class="form-input" id="categoryName" placeholder="Enter category name">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal('categoryModal')">Cancel</button>
        <button class="btn btn-primary" id="saveCategoryBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- Link Modal -->
  <div class="modal-overlay" id="linkModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="linkModalTitle">Add Link</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="linkId">
        <div class="form-group">
          <label class="form-label">Link Name</label>
          <input type="text" class="form-input" id="linkName" placeholder="Enter link name">
        </div>
        <div class="form-group">
          <label class="form-label">URL</label>
          <input type="url" class="form-input" id="linkUrl" placeholder="https://example.com">
        </div>
        <div class="form-group">
          <label class="form-label">Category</label>
          <select class="form-select" id="linkCategory"></select>
        </div>
        <div class="form-group">
          <label class="form-label">Tags (comma separated)</label>
          <input type="text" class="form-input" id="linkTags" placeholder="tag1, tag2, tag3">
        </div>
        <div class="form-group">
          <label class="form-label">Custom Icon URL (optional)</label>
          <input type="text" class="form-input" id="linkCustomIcon" placeholder="https://example.com/icon.png">
        </div>
        <div class="form-group">
          <label class="form-label">Open Behavior</label>
          <select class="form-select" id="linkOpenBehaviorModal">
            <option value="">Use Global Setting</option>
            <option value="newTab">New Tab</option>
            <option value="sameTab">Same Tab</option>
          </select>
        </div>

        <!-- Monitoring Section -->
        <div class="form-group" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
          <label class="form-checkbox">
            <input type="checkbox" id="linkMonitoringEnabled">
            <span>Enable Status Monitoring</span>
          </label>
        </div>
        <div id="monitoringOptions" style="display: none;">
          <div class="form-group">
            <label class="form-label">Host/IP (optional)</label>
            <input type="text" class="form-input" id="linkMonitoringHost" placeholder="Leave blank to use URL domain">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Port (optional)</label>
              <input type="number" class="form-input" id="linkMonitoringPort" placeholder="ICMP ping if blank">
            </div>
            <div class="form-group">
              <label class="form-label">Check Interval</label>
              <select class="form-select" id="linkMonitoringInterval">
                <option value="30">30 seconds</option>
                <option value="60">1 minute</option>
                <option value="120">2 minutes</option>
                <option value="300">5 minutes</option>
                <option value="600">10 minutes</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal('linkModal')">Cancel</button>
        <button class="btn btn-primary" id="saveLinkBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- User Modal -->
  <div class="modal-overlay" id="userModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="userModalTitle">Add User</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="userId">
        <div class="form-group">
          <label class="form-label">Username</label>
          <input type="text" class="form-input" id="newUsername" placeholder="Enter username" autocomplete="off">
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="newUserPassword" placeholder="Enter password" autocomplete="new-password">
        </div>
        <div class="form-group">
          <label class="form-label">Confirm Password</label>
          <input type="password" class="form-input" id="newUserPasswordConfirm" placeholder="Confirm password" autocomplete="new-password">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal('userModal')">Cancel</button>
        <button class="btn btn-primary" id="saveUserBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- Widget Modal -->
  <div class="modal-overlay" id="widgetModal">
    <div class="modal" style="max-width: 600px;">
      <div class="modal-header">
        <h3 class="modal-title" id="widgetModalTitle">Add Widget</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="widgetId">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Widget Type</label>
            <select class="form-select" id="widgetType">
              <option value="server-monitor">Server Monitor</option>
              <option value="clock">Clock</option>
              <option value="weather">Weather</option>
              <option value="iframe">Iframe Embed</option>
              <option value="custom-html">Custom HTML</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Position</label>
            <select class="form-select" id="widgetPosition">
              <option value="above-categories">Above Categories</option>
              <option value="below-categories">Below Categories</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Title (optional)</label>
          <input type="text" class="form-input" id="widgetTitle" placeholder="Widget title">
        </div>
        <div class="form-group">
          <label class="form-checkbox">
            <input type="checkbox" id="widgetEnabled" checked>
            <span>Enabled</span>
          </label>
        </div>

        <!-- Server Monitor Config -->
        <div id="configServerMonitor" class="widget-config-section">
          <h4 class="card-title" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">Server Monitor Settings</h4>
          <div class="form-group">
            <label class="form-label">Servers to Monitor</label>
            <div id="serverMonitorList" class="server-list"></div>
            <button type="button" class="btn btn-sm" id="addServerBtn" style="margin-top: 0.5rem;">+ Add Server</button>
          </div>

          <h4 class="card-title" style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">Display Options</h4>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Display Mode</label>
              <select class="form-select" id="serverDisplayMode">
                <option value="list">List (vertical)</option>
                <option value="grid">Grid (columns)</option>
                <option value="compact">Compact (inline)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Columns (Grid mode)</label>
              <select class="form-select" id="serverColumns">
                <option value="2">2 Columns</option>
                <option value="3">3 Columns</option>
                <option value="4">4 Columns</option>
                <option value="auto">Auto-fit</option>
              </select>
            </div>
          </div>

          <h4 class="card-title" style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">Item Styling</h4>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Item Style</label>
              <select class="form-select" id="serverItemStyle">
                <option value="card">Card (with background)</option>
                <option value="text">Text Only</option>
                <option value="minimal">Minimal (icon + name)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Text Size</label>
              <select class="form-select" id="serverTextSize">
                <option value="small">Small</option>
                <option value="medium">Medium</option>
                <option value="large">Large</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Item Background</label>
              <div class="color-picker-wrapper">
                <input type="color" class="color-picker" id="serverItemBgPicker" value="#ffffff">
                <input type="text" class="form-input color-value" id="serverItemBgColor" value="" placeholder="Use theme default">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Text Color</label>
              <div class="color-picker-wrapper">
                <input type="color" class="color-picker" id="serverTextColorPicker" value="#ffffff">
                <input type="text" class="form-input color-value" id="serverTextColor" value="" placeholder="Use theme default">
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Hover Effect</label>
              <select class="form-select" id="serverHoverEffect">
                <option value="none">None</option>
                <option value="glow">Glow</option>
                <option value="scale">Scale</option>
                <option value="fade">Fade</option>
                <option value="slide">Slide</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Border Radius</label>
              <select class="form-select" id="serverBorderRadius">
                <option value="none">None (square)</option>
                <option value="small">Small (4px)</option>
                <option value="medium">Medium (8px)</option>
                <option value="large">Large (12px)</option>
                <option value="pill">Pill (24px)</option>
              </select>
            </div>
          </div>

          <h4 class="card-title" style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">Widget Container</h4>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Container Style</label>
              <select class="form-select" id="serverContainerStyle">
                <option value="card">Card (with background)</option>
                <option value="transparent">Transparent</option>
                <option value="bordered">Border Only</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Container Background</label>
              <div class="color-picker-wrapper">
                <input type="color" class="color-picker" id="serverContainerBgPicker" value="#ffffff">
                <input type="text" class="form-input color-value" id="serverContainerBgColor" value="" placeholder="Use theme default">
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="serverShowLatency" checked>
              <span>Show Latency</span>
            </label>
          </div>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="serverShowLastChecked">
              <span>Show Last Checked Time</span>
            </label>
          </div>
        </div>

        <!-- Clock Config -->
        <div id="configClock" class="widget-config-section" style="display: none;">
          <h4 class="card-title" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">Clock Settings</h4>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Time Format</label>
              <select class="form-select" id="clockFormat">
                <option value="12">12-hour</option>
                <option value="24">24-hour</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Timezone</label>
              <select class="form-select" id="clockTimezone">
                <option value="local">Local</option>
                <option value="UTC">UTC</option>
                <option value="America/New_York">New York</option>
                <option value="America/Chicago">Chicago</option>
                <option value="America/Denver">Denver</option>
                <option value="America/Los_Angeles">Los Angeles</option>
                <option value="Europe/London">London</option>
                <option value="Europe/Paris">Paris</option>
                <option value="Europe/Berlin">Berlin</option>
                <option value="Asia/Tokyo">Tokyo</option>
                <option value="Asia/Shanghai">Shanghai</option>
                <option value="Australia/Sydney">Sydney</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="clockShowDate" checked>
              <span>Show Date</span>
            </label>
          </div>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="clockShowSeconds">
              <span>Show Seconds</span>
            </label>
          </div>
        </div>

        <!-- Weather Config -->
        <div id="configWeather" class="widget-config-section" style="display: none;">
          <h4 class="card-title" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">Weather Settings</h4>
          <div class="form-group">
            <label class="form-label">OpenWeatherMap API Key</label>
            <input type="text" class="form-input" id="weatherApiKey" placeholder="Your API key">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Location</label>
              <input type="text" class="form-input" id="weatherLocation" placeholder="City name or coordinates">
            </div>
            <div class="form-group">
              <label class="form-label">Units</label>
              <select class="form-select" id="weatherUnits">
                <option value="imperial">Fahrenheit</option>
                <option value="metric">Celsius</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Iframe Config -->
        <div id="configIframe" class="widget-config-section" style="display: none;">
          <h4 class="card-title" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">Iframe Settings</h4>
          <div class="form-group">
            <label class="form-label">URL to Embed</label>
            <input type="url" class="form-input" id="iframeUrl" placeholder="https://example.com">
          </div>
          <div class="form-group">
            <label class="form-label">Height (px)</label>
            <input type="number" class="form-input" id="iframeHeight" value="300" placeholder="300">
          </div>
        </div>

        <!-- Custom HTML Config -->
        <div id="configCustomHtml" class="widget-config-section" style="display: none;">
          <h4 class="card-title" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">Custom HTML Settings</h4>
          <div class="form-group">
            <label class="form-label">HTML Content</label>
            <textarea class="form-input" id="customHtmlContent" rows="6" placeholder="<div>Your HTML here</div>"></textarea>
          </div>
          <p class="text-muted" style="font-size: 0.8rem;">Warning: Custom HTML can pose security risks. Only use trusted content.</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal('widgetModal')">Cancel</button>
        <button class="btn btn-primary" id="saveWidgetBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- Re-authentication Modal -->
  <div class="modal-overlay" id="reAuthModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Session Expired</h2>
      </div>
      <div class="modal-body">
        <p class="text-muted mb-20">Your session has expired. Please log in again to continue. Your unsaved changes will be preserved.</p>
        <div class="form-group">
          <label class="form-label">Username</label>
          <input type="text" class="form-input" id="reAuthUsername" autocomplete="username">
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="reAuthPassword" autocomplete="current-password">
        </div>
        <div id="reAuthError" class="message error hidden"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="reAuthBtn">Log In</button>
      </div>
    </div>
  </div>

  <!-- Entra ID Setup Wizard Modal -->
  <div class="modal-overlay" id="entraWizardModal">
    <div class="modal" style="max-width: 650px;">
      <div class="modal-header">
        <h3 class="modal-title">Microsoft Entra ID Setup Wizard</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Progress indicator -->
        <div class="wizard-progress" style="display: flex; justify-content: space-between; margin-bottom: 1.5rem; padding: 0 1rem;">
          <div class="wizard-step-indicator" data-step="1"><span class="step-number">1</span><span class="step-label">Create App</span></div>
          <div class="wizard-step-indicator" data-step="2"><span class="step-number">2</span><span class="step-label">Client ID</span></div>
          <div class="wizard-step-indicator" data-step="3"><span class="step-number">3</span><span class="step-label">Tenant ID</span></div>
          <div class="wizard-step-indicator" data-step="4"><span class="step-number">4</span><span class="step-label">Secret</span></div>
          <div class="wizard-step-indicator" data-step="5"><span class="step-number">5</span><span class="step-label">Redirect</span></div>
          <div class="wizard-step-indicator" data-step="6"><span class="step-number">6</span><span class="step-label">Finish</span></div>
        </div>

        <!-- Step 1: Create App Registration -->
        <div class="wizard-step" id="wizardStep1">
          <h4 style="margin-bottom: 1rem;">Step 1: Create App Registration in Azure</h4>
          <ol class="wizard-instructions">
            <li>Go to <a href="https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps" target="_blank" rel="noopener">Azure Portal &gt; App Registrations</a></li>
            <li>Click <strong>"New registration"</strong></li>
            <li>Enter a name (e.g., "Dashma SSO")</li>
            <li>Under "Supported account types", select:<br>
              <em>"Accounts in this organizational directory only"</em></li>
            <li>Leave Redirect URI blank for now (we'll add it later)</li>
            <li>Click <strong>"Register"</strong></li>
          </ol>
          <p class="text-muted" style="margin-top: 1rem;">After clicking Register, you'll be taken to the app's Overview page. Continue to the next step.</p>
        </div>

        <!-- Step 2: Get Client ID -->
        <div class="wizard-step" id="wizardStep2" style="display: none;">
          <h4 style="margin-bottom: 1rem;">Step 2: Copy Application (Client) ID</h4>
          <ol class="wizard-instructions">
            <li>On your app's <strong>Overview</strong> page in Azure</li>
            <li>Find <strong>"Application (client) ID"</strong></li>
            <li>Click the copy icon next to it</li>
            <li>Paste it below:</li>
          </ol>
          <div class="form-group" style="margin-top: 1rem;">
            <label class="form-label">Application (Client) ID</label>
            <input type="text" class="form-input" id="wizardClientId" placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
          </div>
        </div>

        <!-- Step 3: Get Tenant ID -->
        <div class="wizard-step" id="wizardStep3" style="display: none;">
          <h4 style="margin-bottom: 1rem;">Step 3: Copy Directory (Tenant) ID</h4>
          <ol class="wizard-instructions">
            <li>On the same <strong>Overview</strong> page</li>
            <li>Find <strong>"Directory (tenant) ID"</strong></li>
            <li>Click the copy icon next to it</li>
            <li>Paste it below:</li>
          </ol>
          <div class="form-group" style="margin-top: 1rem;">
            <label class="form-label">Directory (Tenant) ID</label>
            <input type="text" class="form-input" id="wizardTenantId" placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
          </div>
        </div>

        <!-- Step 4: Create Client Secret -->
        <div class="wizard-step" id="wizardStep4" style="display: none;">
          <h4 style="margin-bottom: 1rem;">Step 4: Create Client Secret</h4>
          <ol class="wizard-instructions">
            <li>In the left sidebar, click <strong>"Certificates & secrets"</strong></li>
            <li>Click <strong>"New client secret"</strong></li>
            <li>Enter a description (e.g., "Dashma")</li>
            <li>Select an expiration period</li>
            <li>Click <strong>"Add"</strong></li>
            <li><strong>Important:</strong> Copy the <strong>"Value"</strong> immediately (it won't be shown again!)</li>
            <li>Paste it below:</li>
          </ol>
          <div class="form-group" style="margin-top: 1rem;">
            <label class="form-label">Client Secret Value</label>
            <input type="password" class="form-input" id="wizardClientSecret" placeholder="Your client secret value">
            <p class="text-muted" style="font-size: 0.8rem; margin-top: 0.25rem;">Copy the "Value" column, not the "Secret ID"</p>
          </div>
        </div>

        <!-- Step 5: Configure Redirect URI -->
        <div class="wizard-step" id="wizardStep5" style="display: none;">
          <h4 style="margin-bottom: 1rem;">Step 5: Configure Redirect URI</h4>
          <p style="margin-bottom: 1rem;">Now we need to tell Azure where to send users after they sign in.</p>
          <ol class="wizard-instructions">
            <li>In the left sidebar, click <strong>"Authentication"</strong></li>
            <li>Click <strong>"Add Redirect URI"</strong> (or the + icon)</li>
            <li>Paste this Redirect URI:
              <div class="copy-field" style="margin: 0.5rem 0;">
                <input type="text" class="form-input" id="wizardRedirectUriDisplay" readonly style="background: rgba(255,255,255,0.05);">
                <button type="button" class="btn btn-sm" onclick="copyWizardRedirectUri()" style="margin-left: 0.5rem;">Copy</button>
              </div>
            </li>
            <li>Click <strong>"Save"</strong></li>
          </ol>
          <div class="form-group" style="margin-top: 1rem;">
            <label class="form-label">Redirect URI (auto-detected)</label>
            <input type="text" class="form-input" id="wizardRedirectUri" placeholder="https://yourdomain.com/auth/callback">
            <p class="text-muted" style="font-size: 0.8rem; margin-top: 0.25rem;">Edit only if your Dashma is behind a reverse proxy with a different URL</p>
          </div>
        </div>

        <!-- Step 6: Validate and Finish -->
        <div class="wizard-step" id="wizardStep6" style="display: none;">
          <h4 style="margin-bottom: 1rem;">Step 6: Review and Apply</h4>
          <p style="margin-bottom: 1rem;">Review your configuration before applying:</p>
          <div class="wizard-review" style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
            <div class="review-item"><strong>Client ID:</strong> <span id="reviewClientId"></span></div>
            <div class="review-item"><strong>Tenant ID:</strong> <span id="reviewTenantId"></span></div>
            <div class="review-item"><strong>Client Secret:</strong> <span id="reviewClientSecret"></span></div>
            <div class="review-item"><strong>Redirect URI:</strong> <span id="reviewRedirectUri"></span></div>
          </div>
          <div id="wizardValidationResult" style="display: none; padding: 0.75rem; border-radius: 6px; margin-bottom: 1rem;"></div>
          <button type="button" class="btn btn-secondary" id="validateEntraConfig" style="margin-bottom: 1rem;">Validate Configuration</button>
        </div>

        <div id="wizardError" class="message error" style="display: none; margin-top: 1rem;"></div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="wizardPrevBtn" style="display: none;">Previous</button>
        <button class="btn" onclick="closeModal('entraWizardModal')">Cancel</button>
        <button class="btn btn-primary" id="wizardNextBtn">Next</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <script src="/js/themes.js"></script>
  <script src="/js/admin.js"></script>
</body>
</html>
